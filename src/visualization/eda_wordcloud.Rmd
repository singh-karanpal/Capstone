---
title: "EDA wordcloud"
author: "UBC-MDS Team"
date: "20/05/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

These two wordcloud plots consider comments from Nasim, avoiding some of the most frequent words that could be in any comment. In this case, we specific remove the words: "not", "work", "staff", "would", "should", "make", "job", "all", "other", "which", "employee".

## By Word

### Wordcloud - question 1
```{r loading, include=FALSE}
# load libraries
library(tm)
library(wordcloud)

# read data
wordcloud_q1_pp <- readr::read_csv(file = "../../data/wordcloud_q1_pp.csv")  # preprocessed train comments
wordcloud_q2_pp <- readr::read_csv(file = "../../data/wordcloud_q2_pp.csv")
```


```{r wordcloud, echo=FALSE, fig.width=5, fig.height=5, warning=FALSE}

docs <- Corpus(VectorSource(wordcloud_q1_pp$Comment))  # Create a corpus

dtm <- TermDocumentMatrix(docs)
matrix <- as.matrix(dtm)
words <- rowSums(matrix)
df <- data.frame(freq=words)

set.seed(42) # for reproducibility
wordcloud(words = rownames(df), freq = df$freq, min.freq = 1,
          max.words=100, random.order=FALSE, rot.per=0.35,
          colors=brewer.pal(8, "Dark2"))
```


### Wordcloud - question 2 (Unsupervised dataset: 2015, 2018, 2020)
```{r wordcloud question 2, fig.width=5, fig.height=5,echo=FALSE, warning=FALSE}

# wordcloud code
docs_q2 <- Corpus(VectorSource(wordcloud_q2_pp$Comment))  # Create a corpus

dtm_q2 <- TermDocumentMatrix(docs_q2)
matrix_q2 <- as.matrix(dtm_q2)
words_q2 <- rowSums(matrix_q2)
df_q2 <- data.frame(freq=words_q2)

set.seed(42) # for reproducibility
wordcloud(words = rownames(df_q2), freq = df_q2$freq, min.freq = 1,
          max.words=100, random.order=FALSE, rot.per=0.35,
          colors=brewer.pal(8, "Dark2"))
```


## n-grams^[Note: For the bigram's wordcloud we use the preprocessed comments, but we didn't remove any additional words.]
### Wordcloud of biagrams - question 1
```{r call data for question 1,  include=FALSE}
#fig.width=6, fig.height=6,
library(dplyr)
library(tidytext)
library(igraph)
library(ggraph)

set.seed(42)

# # uncomment and run the next code only once to have the right format:
train_X_q1_pp <- readr::read_csv(file = "../../data/X_train_pp.csv")  # preprocessed train comments
train_X_q1_pp <- tibble::rowid_to_column(train_X_q1_pp, "ID")
```

```{r bigrams question 1, fig.width=5, fig.height=5, echo=FALSE, warning=FALSE}
# making the bigrams
bigrams_q1 <- train_X_q1_pp %>% 
  unnest_tokens(bigram, Comment, token ="ngrams", n=2) %>% 
  # filter(bigram != "would like") %>% 
  count(bigram, sort = TRUE)

# wordcloud code
pal=brewer.pal(8,"Blues")
pal=pal[-(1:3)]
wordcloud(bigrams_q1$bigram, bigrams_q1$n, max.words=75,random.order = F, colors=brewer.pal(8, "Dark2"))
```

### Wordcloud of biagrams - question 2
```{r call data for question 2, include=FALSE}
set.seed(42)
unsupervised_q2 <- readr::read_csv(file = "../../data/unsuperv_q2_pp.csv")
unsupervised_q2 <- tibble::rowid_to_column(unsupervised_q2, "ID")
```


```{r bigrams question 2, fig.width=5, fig.height=5, echo=FALSE, warning=FALSE}
# making the bigrams
bigrams_q2 <- data.frame(unsupervised_q2) %>%
  unnest_tokens(bigram, Comment, token ="ngrams", n=2) %>% 
  count(bigram, sort = TRUE)

# wordcloud code
pal=brewer.pal(8,"Blues")
pal=pal[-(1:3)]
wordcloud(bigrams_q2$bigram, bigrams_q2$n, max.words=75,random.order = F, colors=brewer.pal(8, "Dark2"))
```
